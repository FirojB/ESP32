// ESP32 as a server, respond to browser over LAN

#include"WiFi.h"
#include<random>
WiFiServer server(80);

void setup() 
{
  pinMode(16, OUTPUT);
  Serial.begin(115200);
  WiFi.begin("NOWTVU9FNU","YqTRz5ZedDbe");
  Serial.print("I'm Connecting to NOWTVU9FNU wifi ...");
  while(WiFi.status()!=WL_CONNECTED)
  {
   Serial.print(" . ");
   digitalWrite(16,HIGH);
   delay(100);
   digitalWrite(16,LOW);
   delay(100);
  }

  Serial.println();
  Serial.println(" I'm online now , my IP is :");  
  Serial.print(WiFi.localIP());
  digitalWrite(16,HIGH);
  server.begin();
  Serial.print(" Server started ");
}

void loop()
{
WiFiClient client_obj = server.available(); //creating client object of wifi client
if(!client_obj)
  return;

while (!client_obj.available()) 
 {
    // keep in loop till get request from client- Web browser
 }
 
 /*
 //To get client detals and store in req string variable
 String req = client_obj.readString();
 // print the client details
// Serial.println(req);


 Store the message in string vaiable replyas HTML but in single line
    <!DOCTYPE HTML>
    <HTML>
    <BODY>
    !!!!!!!   Hello, from ESP32 Server  !!!!!!!
    </BODY>
    </HTML>
 */

// We can usre real sensor data and then send to web browser, but her i am using dummy data generated by rundom function.
float temp_rand = random(-3.0,60);
float air_quali = random(1.1, 5.5);
float humidity  = random (0.0, 100.0);
 
 String reply = "HTTP/1.1 200 OK\r\nContenttype:text/html\r\n\r\n<!DOCTYPE HTML><HTML><BODY><p>Current temperature is : ";
 reply+=temp_rand;
 reply+="<br>Air Quality : ";
 reply+=air_quali;
 reply+="<br>Humidity : ";
 reply+=humidity;
 reply+="</p></BODY></HTML>";

 client_obj.print(reply);
 delay(100);
 
// client_obj.stop();
}
